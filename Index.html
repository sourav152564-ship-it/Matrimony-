<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matrimony News Feed & Chat</title>
<style>
body{font-family:Arial;background:#f0f2f5;margin:0;padding:0;}
header{display:flex;justify-content:center;gap:10px;background:#4267B2;padding:10px 0;color:white;position:sticky;top:0;z-index:100;}
header button{padding:8px 15px;border:none;border-radius:5px;background:white;color:#4267B2;font-weight:bold;cursor:pointer;}
header button:hover{background:#e4e6eb;}
.container{max-width:900px;margin:20px auto;padding:0 15px;}
.post-form,.news-feed,.friend-section,.chat-section{background:white;padding:20px;margin-bottom:20px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.post-form h2,.friend-section h2,.chat-section h2{margin-top:0;color:#4267B2;}
.post-form input,.post-form textarea,.friend-section input,.chat-section input{width:100%;padding:10px;margin:8px 0 15px 0;border:1px solid #ccc;border-radius:5px;}
.post-form button,.friend-section button,.chat-section button{width:100%;padding:10px;background:#4267B2;color:white;border:none;border-radius:5px;font-weight:bold;cursor:pointer;}
.post-form button:hover,.friend-section button:hover,.chat-section button:hover{background:#365899;}
.news-feed{max-height:600px;overflow-y:auto;}
.post{border-bottom:1px solid #ddd;padding:10px 0;}
.post:last-child{border-bottom:none;}
.post img,.post video{width:100%;border-radius:8px;margin-top:10px;max-height:600px;object-fit:cover;cursor:pointer;}
.like,.comment-btn{margin-right:10px;cursor:pointer;color:#4267B2;font-weight:bold;}
.comment-section{margin-top:10px;padding-left:20px;}
.comment{border-bottom:1px solid #ddd;padding:5px 0;}
.comment input{width:80%;padding:5px;margin-right:5px;}
.comment button{padding:5px 10px;background:#4267B2;color:white;border:none;border-radius:5px;cursor:pointer;}
.comment button:hover{background:#365899;}
</style>
</head>
<body>

<header>
<button onclick="showSection('news')">News Feed</button>
<button onclick="showSection('friend')">Friend Request/Search</button>
<button onclick="showSection('chat')">Chat</button>
</header>

<div class="container">

<!-- News Feed -->
<div class="news-feed" id="news">
<div class="post-form">
<h2>Post Something</h2>
<textarea id="post-text" placeholder="What's on your mind?"></textarea>
<input type="file" id="post-file">
<button onclick="sendPost()">Post</button>
</div>
<div id="feed"></div>
</div>

<!-- Friend Section -->
<div class="friend-section" id="friend" style="display:none;">
<h2>Friend Search</h2>
<input type="text" id="friend-search" placeholder="Enter friend name">
<button onclick="searchFriend()">Search</button>
<div id="friend-results"></div>
</div>

<!-- Chat Section -->
<div class="chat-section" id="chat" style="display:none;">
<h2>Chat</h2>
<input type="text" id="chat-to" placeholder="Friend name">
<input type="text" id="chat-msg" placeholder="Type your message">
<button onclick="sendChat()">Send</button>
<div id="chat-history"></div>
</div>

</div>

<script>
function showSection(section){
['news','friend','chat'].forEach(id=>document.getElementById(id).style.display=(id===section)?'block':'none');
}

let postIdCounter=0;
let posts={};

// Send post
async function sendPost(){
const text=document.getElementById('post-text').value;
const fileInput=document.getElementById('post-file');
const feed=document.getElementById('feed');

let formData=new FormData();
formData.append('text', text);
if(fileInput.files.length>0) formData.append('file', fileInput.files[0]);

await fetch('/send_post',{method:'POST',body:formData});

const postId='post-'+postIdCounter++;
let postHTML=`<div class="post" id="${postId}"><p><strong>Guest:</strong> ${text}</p>`;
if(fileInput.files.length>0){
const f=fileInput.files[0];
if(f.type.startsWith('video')) postHTML+=`<video controls src="${URL.createObjectURL(f)}"></video>`;
else postHTML+=`<img src="${URL.createObjectURL(f)}" onclick="showFullScreen(this)">`;
}
postHTML+='</div>';
feed.prepend(postHTML);
document.getElementById('post-text').value=''; fileInput.value='';
}

// Full screen image
function showFullScreen(el){
const overlay=document.createElement('div');
overlay.style.position='fixed';
overlay.style.top='0'; overlay.style.left='0'; overlay.style.width='100%';
overlay.style.height='100%'; overlay.style.background='rgba(0,0,0,0.9)';
overlay.style.display='flex'; overlay.style.justifyContent='center'; overlay.style.alignItems='center';
overlay.style.zIndex='9999';
const img=el.cloneNode();
img.style.maxHeight='90%'; img.style.maxWidth='90%';
overlay.appendChild(img);
overlay.onclick=()=>document.body.removeChild(overlay);
document.body.appendChild(overlay);
}

// Friend demo
let friends=['Alice','Bob','Charlie','David'];
function searchFriend(){
const val=document.getElementById('friend-search').value.toLowerCase();
const results=friends.filter(f=>f.toLowerCase().includes(val));
document.getElementById('friend-results').innerHTML=results.map(f=>`<div>${f} <button onclick="sendFriendRequest('${f}')">Add Friend</button></div>`).join('');
}
async function sendFriendRequest(name){
await fetch('/send_friend_request',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({friend_name:name})
});
alert('Friend Request sent to '+name);
}

// Chat
async function sendChat(){
const to=document.getElementById('chat-to').value;
const msg=document.getElementById('chat-msg').value;
if(!to||!msg) return;
await fetch('/send_chat',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({to_user:to,message:msg})
});
document.getElementById('chat-history').innerHTML+=`<div><strong>To ${to}:</strong> ${msg}</div>`;
document.getElementById('chat-msg').value='';
}
</script>

</body>
</html>
